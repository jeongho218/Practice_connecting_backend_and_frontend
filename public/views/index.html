<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Bootstrap CSS 파일을 CDN을 통해 불러옵니다 -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
    />
    <title>메인 페이지</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  </head>
  <body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
      <div class="container">
        <!-- 왼쪽에 회원가입 버튼과 로그인 버튼 -->
        <div class="d-flex">
          <button
            type="button"
            class="btn btn-primary me-2"
            data-bs-toggle="modal"
            data-bs-target="#signupModal"
          >
            회원가입
          </button>
          <a href="#" class="btn btn-secondary">로그인</a>
        </div>

        <!-- 오른쪽에 홈 링크 버튼, 게시글 링크 버튼, 댓글 링크 버튼 -->
        <div class="d-flex">
          <a href="/views" class="btn btn-link me-2 text-light">홈</a>
          <a href="/views/mypage" class="btn btn-link me-2 text-light"
            >마이페이지</a
          >
          <a href="/views/posts.html" class="btn btn-link me-2 text-light"
            >게시글</a
          >
          <a href="/views/comments.html" class="btn btn-link text-light"
            >댓글</a
          >
        </div>
      </div>
    </nav>
    <div class="container mt-5">
      <!-- 내용을 이곳에 추가하세요 -->
    </div>

    <!-- 알림 메시지를 위한 Bootstrap Alert 컴포넌트 추가 -->
    <div
      class="alert alert-danger d-none"
      id="alertFailureMessage"
      role="alert"
    >
      회원 가입에 실패했습니다. 다시 시도하세요.
      <a href="#" class="alert-link" onclick="closeAlert('alertSuccessMessage')"
        >닫기</a
      >
    </div>

    <div
      class="alert alert-success d-none"
      id="alertSuccessMessage"
      role="alert"
    >
      회원 가입이 성공적으로 완료되었습니다.
      <a href="#" class="alert-link" onclick="closeAlert('alertFailureMessage')"
        >닫기</a
      >
    </div>

    <!-- 팝업 모달 창 -->
    <div
      class="modal fade"
      id="signupModal"
      tabindex="-1"
      aria-labelledby="signupModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="signupModalLabel">회원 가입</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <!-- 회원 가입 양식을 이곳에 추가하세요 -->
            <form>
              <div class="mb-3">
                <label for="email" class="form-label">이메일</label>
                <input
                  type="email"
                  class="form-control"
                  id="email"
                  placeholder="이메일을 입력하세요"
                />
              </div>
              <div class="mb-3">
                <label for="password" class="form-label">비밀번호</label>
                <input
                  type="password"
                  class="form-control"
                  id="password"
                  placeholder="비밀번호를 입력하세요"
                />
              </div>
              <div class="mb-3">
                <label for="name" class="form-label">이름</label>
                <input
                  type="text"
                  class="form-control"
                  id="name"
                  placeholder="이름을 입력하세요"
                />
              </div>
              <div class="mb-3">
                <label for="age" class="form-label">나이</label>
                <input
                  type="number"
                  class="form-control"
                  id="age"
                  placeholder="나이를 입력하세요"
                />
              </div>
              <div class="mb-3">
                <label for="gender" class="form-label">성별</label>
                <select class="form-select" id="gender">
                  <option value="male">남성</option>
                  <option value="female">여성</option>
                </select>
              </div>
              <div class="mb-3">
                <label for="profileImage" class="form-label"
                  >프로필 이미지 URL</label
                >
                <input
                  type="url"
                  class="form-control"
                  id="profileImage"
                  placeholder="프로필 이미지 URL을 입력하세요"
                />
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              닫기
            </button>
            <button
              type="button"
              class="btn btn-primary"
              onclick="submitSignUpForm()"
              data-bs-dismiss="modal"
            >
              가입 완료
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Bootstrap CSS 파일을 CDN을 통해 불러옵니다 -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
    />

    <!-- Bootstrap JavaScript 파일을 CDN을 통해 불러옵니다 -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js"></script>

    <script>
      // 모달이 닫힐 때 입력 칸의 내용을 초기화합니다
      $("#signupModal").on("hidden.bs.modal", function () {
        document.getElementById("email").value = "";
        document.getElementById("password").value = "";
        document.getElementById("name").value = "";
        document.getElementById("age").value = "";
        document.getElementById("gender").value = "male";
        document.getElementById("profileImage").value = "";
      });

      // 회원가입 성공 알림
      function showSuccessAlert() {
        document
          .getElementById("alertSuccessMessage")
          .classList.remove("d-none");

        // 5초 후에 알림 숨김
        setTimeout(function () {
          closeAlert("alertSuccessMessage");
        }, 5000);
      }

      // 회원가입 실패 알림
      function showFailureAlert() {
        document
          .getElementById("alertFailureMessage")
          .classList.remove("d-none");

        // 5초 후에 알림 숨김
        setTimeout(function () {
          closeAlert("alertFailureMessage");
        }, 5000);
      }

      // 알림 메시지를 숨김
      function closeAlert(alertId) {
        document.getElementById(alertId).classList.add("d-none");
      }

      function submitSignUpForm() {
        // 모달에서 입력된 데이터를 가져옵니다
        const email = document.getElementById("email").value;
        const password = document.getElementById("password").value;
        const name = document.getElementById("name").value;
        const age = parseInt(document.getElementById("age").value);
        const gender = document.getElementById("gender").value;
        const profileImage = document.getElementById("profileImage").value;

        // 데이터를 객체로 묶습니다
        const userData = {
          email: email,
          password: password,
          name: name,
          age: age,
          gender: gender,
          profileImage: profileImage,
        };

        // 데이터를 JSON 형식으로 변환합니다
        const jsonData = JSON.stringify(userData);

        // AJAX 요청을 보냅니다 (Fetch API 사용)
        fetch("/api/users", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: jsonData,
        })
          .then((response) => {
            if (response.ok) {
              // 요청이 성공적으로 처리되었을 때 실행할 코드
              console.log("가입이 완료되었습니다.");
              showSuccessAlert();
            } else {
              // 요청이 실패했을 때 실행할 코드
              console.error("가입 요청 실패");
              showFailureAlert(); // 회원 가입 실패 시 알림 표시
            }
          })
          .catch((error) => {
            console.error("오류:", error);
            showFailureAlert(); // 오류 시 알림 표시
          });
      }
    </script>
  </body>
</html>
